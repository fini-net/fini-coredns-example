# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This repository demonstrates CoreDNS serving zone files generated by DNSControl. It provides example DNS configurations for `example.com` and `example.org` domains, which can be served locally via CoreDNS or deployed as a container.

## Common Commands

All development tasks are managed through `just` commands. Run `just` to see available recipes.

### DNS Management
- `just preview` - Preview DNS changes using DNSControl
- `just push` - Generate BIND zone files from JavaScript configurations

### Container Operations  
- `just build_con` - Build container with Podman
- `just run_con` - Run container locally (DNS server on port 1029)
- `just test_con` - Test containerized DNS server with dig
- `just clean_con` - Stop and remove test container
- `just ghcr_push` - Push container to GitHub Container Registry

### Development Workflow
- `just branch <name>` - Start new feature branch
- `just pr` - Create pull request from current branch
- `just merge` - Merge PR and return to main branch
- `just sync` - Return to main branch and pull latest

### Prerequisites Installation (macOS)
- `just install_prereqs` - Install required tools via Homebrew

## Architecture

### DNS Configuration System
- **DNSControl**: JavaScript-based DNS configuration in `dns/` directory
  - `dnsconfig.js` - Main configuration with shared functions and defaults
  - `example.com.js` and `example.org.js` - Domain-specific configurations
  - Generated zone files output to `dns/zones/`

### Container Structure
- **Base**: Uses official `coredns/coredns` image
- **Configuration**: `Container_root/Corefile` defines DNS server behavior
- **Zone Files**: Generated BIND files copied to `/zones/` in container
- **Ports**: Container serves DNS on port 53, mapped to 1029 locally

### Key Directories
- `dns/` - DNSControl configurations and generated zone files
- `conf/coredns/` - Local CoreDNS development configuration (port 5300)
- `Container_root/` - Container configuration files
- `.just/` - Shared justfile includes for GitHub workflow automation

## Development Standards

All example domains and IP addresses comply with:
- RFC2606 (reserved DNS names like .example)
- RFC1918 (private IP ranges: 10.0.0.0/8)  
- RFC4193 (IPv6 unique local addresses: fc00::/7)

## Quality Checks

- **Markdown Linting**: Runs automatically via GitHub Actions using markdownlint-cli2
- **Security Scanning**: Checkov analysis via GitHub Actions
- **Configuration**: `.markdownlint.yml` defines linting rules

## Testing

Currently manual testing via `dig` queries. Test the running DNS server:
```bash
dig @localhost -p 1029 www.example.com
dig @localhost -p 5300 calendar.example.org  # local CoreDNS
```